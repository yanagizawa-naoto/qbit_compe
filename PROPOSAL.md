
# Quantum Logistics Simulator: 社会実装へ向けた提案書

![Quantum Logistics Vision](quantum_logistics_vision.png)

## 1. 社会課題の背景

### 物流クライシスと「2024年問題」
現代社会において、物流は生命線ですが、深刻なドライバー不足や長時間労働の規制強化（2024年問題）により、**「運べないリスク」**が現実のものとなっています。
特に都市部のラストワンマイル配送においては、複雑な道路事情や再配達の増加により、従来の配送計画では限界が見えています。

- **ドライバー不足**: 労働力人口の減少と高齢化。
- **効率化の限界**: 熟練ドライバーの勘に頼ったルート作成は属人化しており、継承が困難。
- **CO2削減**: 無駄な移動は燃料消費を増やし、環境負荷を高める。

### 私たちが解決すること
配送車両（全エージェント）の動きを**「全体最適（Global Optimization）」**の視点で制御し、総移動距離と時間を最小化することで、限られたリソースでの最大効率化を実現します。

## 2. 提案するソリューション

**Quantum Logistics Simulator** は、量子アニーリング技術を活用した次世代の配送管理システムです。
従来の手法では計算量が爆発してしまう「複数車両の配送計画問題（VRP）」を、量子コンピュータ（およびそのシミュレータ）上で高速に解くことを目指しています。

### 主な特徴
1.  **リアルタイム全体最適化**:
    状況の変化（新たな配送依頼、渋滞、車両の故障など）に応じて、瞬時に全車両のルートを再計算します。
2.  **マルチエージェント協調**:
    個々の車両が勝手に最短経路を選ぶのではなく、システム全体として最も効率が良いように「役割分担」と「経路選択」を同時に行います。

## 3. 技術的アプローチ: Full VRP QUBO

![QUBO Optimization Concept](qubo_optimization_concept.png)

従来の古典的なアプローチでは、計算量を減らすために「エリア分け（クラスタリング）」と「ルート探索（TSP）」を別々の工程として行うのが一般的でした。本プロジェクトでは、これらを統合し、**単一の巨大なQUBOモデル**として定式化しました。

### 3.1 決定変数 (Decision Variables)
バイナリ変数 $x_{k,t,i}$ を定義します。

- $k$: エージェントID ($1 \dots K$)
- $t$: タイムステップ ($1 \dots T$)
- $i$: 目的地ID ($1 \dots N$)

$$
x_{k,t,i} = \begin{cases} 
1 & \text{エージェント } k \text{ がステップ } t \text{ で目的地 } i \text{ を訪問する} \\
0 & \text{訪問しない}
\end{cases}
$$

### 3.2 定式化 (Mathematical Formulation)
最適化すべきハミルトニアン（エネルギー関数） $H$ は、制約項 $H_{\text{constraint}}$ と目的項 $H_{\text{objective}}$ の和で表されます。

$$ H = A \cdot H_{\text{constraint}} + B \cdot H_{\text{objective}} $$
ここで $A, B$ は重み係数であり、制約を満たすために $A \gg B$ と設定します（本実装では $A=5000, B=1$）。

#### 1. 訪問制約 (Visit Constraint)
全ての目的地 $i$ は、全エージェント・全ステップを通じて**必ず1回だけ**訪問されなければなりません One-Hot制約）。

$$ H_{\text{visit}} = \sum_{i=1}^{N} \left( \sum_{k=1}^{K} \sum_{t=1}^{T} x_{k,t,i} - 1 \right)^2 $$

#### 2. 容量・排他制約 (Exclusivity Constraint)
各エージェント $k$ は、あるステップ $t$ において、**最大で1箇所**しか訪問できません（分身不可）。
本実装では、異なる2地点 $i, j$ が同時に選ばれることにペナルティを与えます。

$$ H_{\text{capacity}} = \sum_{k=1}^{K} \sum_{t=1}^{T} \sum_{i < j} x_{k,t,i} x_{k,t,j} $$

これにより、$\sum_i x_{k,t,i} \le 1$ が誘導されます（何も訪問しないステップは許容されます）。

#### 3. 目的関数: 総移動距離の最小化 (Minimize Distance)
エージェントが移動する総距離を最小化します。
これには「初期位置 ($\text{start}_k$) から最初の目的地への移動」と「目的地間の移動」が含まれます。

$$ H_{\text{dist}} = \sum_{k=1}^{K} \left[ \underbrace{\sum_{i=1}^{N} d(\text{start}_k, i) x_{k,0,i}}_{\text{Initial Move}} + \underbrace{\sum_{t=0}^{T-2} \sum_{i \neq j} d(i, j) x_{k,t,i} x_{k,t+1,j}}_{\text{Route Moves}} \right] $$

ここで、$d(i, j)$ は地点間のユークリッド距離です。第2項は、ステップ $t$ で $i$ にいて、ステップ $t+1$ で $j$ に移動する場合にのみ距離コストが発生する相互作用項（Quadratic Term）です。

### 3.3 実装構成
このモデルを `dimod.BinaryQuadraticModel` を用いて構築し、`OpenJij` の Simulated Annealing (SA) ソルバで解探索を行っています。リアルタイム性を維持するため、目的地数やステップ数を動的に調整しています。

## 4. デモンストレーション

本デモアプリでは、この技術をブラウザ上で視覚的に体験できます。

- **Scenario**: センター（DEPOT）から出発する複数の配送トラック。
- **Action**: 目的地はランダムに生成され、量子モデルが瞬時に最適ルートを割り当てます。
- **Responsiveness**: エージェントが移動するたびに再計算が走り、例えば「Aさんが遅れているから、近くにいるBさんが代わりにその荷物を持つ」といった動的な最適化が可視化されます。

## 5. 今後の展望

現在はシミュレータ（OpenJij）上で動作していますが、このQUBOモデルはそのまま**実機の量子アニーリングマシン（D-Wave等）**に送信して解かせることが可能です。
物流だけでなく、ドローンの群制御、災害時の避難誘導、工場のAGV搬送など、あらゆる「移動と割当の最適化」に応用できる基盤技術となります。
